  deploy:
    name: Deploy to Kind Cluster
    runs-on: ubuntu-latest
    needs: build

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Create Kind Cluster
        uses: helm/kind-action@v1.7.0
        with:
          version: v0.20.0        # modern Kind version
          node_image: kindest/node:v1.27.0  # modern Kubernetes version

      - name: Apply Deployment
        run: kubectl apply -f deployment.yaml

      - name: Apply Service
        run: kubectl apply -f service.yaml

      - name: Wait for Deployment Rollout
        run: kubectl rollout status deployment/wisecow-deployment --timeout=60s

      - name: Verify Pods Running
        run: kubectl get pods -o wide
